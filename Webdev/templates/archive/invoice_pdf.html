<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>{{ current_user.invoice_label or 'Invoice' }} {{ invoice.invoice_number }}</title>
  <style>
    body { font-family: Arial, sans-serif; font-size: 12px; color: #111; }
    .header { display:flex; justify-content: space-between; align-items:flex-start; margin-bottom: 16px; }
    h1 { margin: 0; font-size: 20px; }
    .muted { color:#666; }
    table { width:100%; border-collapse: collapse; margin-top: 12px; }
    th, td { padding: 8px; border-bottom: 1px solid #ddd; text-align:left; }
    th { background: #f5f5f5; }
    .totals { margin-top: 12px; width: 260px; margin-left: auto; }
    .totals div { display:flex; justify-content: space-between; padding: 4px 0; }
    .total { font-weight: bold; font-size: 14px; }
  </style>
</head>
<body>

  <div class="header">
    <div>
      <h1>{{ current_user.invoice_label or 'Invoice' }} {{ invoice.invoice_number }}</h1>
      <div class="muted">Status: {{ invoice.status }}</div>
    </div>
    <div style="text-align:right;">
      <div><strong>Date:</strong> {{ invoice.date.strftime('%Y-%m-%d') }}</div>
      <div><strong>Due:</strong> {{ invoice.due_date.strftime('%Y-%m-%d') }}</div>
    </div>
  </div>

  <div>
    <strong>Billed To:</strong><br>
    {{ invoice.client.name }}<br>
    {% if invoice.client.email %}{{ invoice.client.email }}<br>{% endif %}
    {% if invoice.client.phone %}{{ invoice.client.phone }}<br>{% endif %}
    {% if invoice.client.address %}{{ invoice.client.address }}{% endif %}
  </div>

  <table>
    <thead>
      <tr>
        <th>Description</th>
        <th style="width:90px;">Qty</th>
        <th style="width:110px;">Unit Price</th>
        <th style="width:110px;">Amount</th>
      </tr>
    </thead>
    <tbody>
      {% for item in invoice.items %}
      <tr>
        <td>{{ item.description }}</td>
        <td>{{ item.quantity }}</td>
        <td>${{ "%.2f"|format(item.unit_price) }}</td>
        <td>${{ "%.2f"|format(item.amount) }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="totals">
    <div><span>Subtotal</span><span>${{ "%.2f"|format(invoice.subtotal) }}</span></div>
    <div><span>Tax ({{ invoice.tax_rate }}%)</span><span>${{ "%.2f"|format(invoice.tax_amount) }}</span></div>
    <div class="total"><span>Total</span><span>${{ "%.2f"|format(invoice.total_amount) }}</span></div>
  </div>

  {% if invoice.terms %}
    <div style="margin-top:16px;">
      <strong>Terms & Conditions</strong><br>
      {{ invoice.terms }}
    </div>
  {% endif %}

  {% if invoice.notes %}
    <div style="margin-top:12px;">
      <strong>Notes</strong><br>
      {{ invoice.notes }}
    </div>
  {% endif %}

</body>
</html>